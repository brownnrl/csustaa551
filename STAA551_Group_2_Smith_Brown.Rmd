---
title: "R Notebook"
output: pdf_document
author: "Nelson Brown and Bryce Smith"
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
---
```{r, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r, include=FALSE}
library(dplyr)
library(car)
library(ggplot2)
library(grid)
library(gridExtra)
library(ggthemes)
library(lubridate)
library(GGally)
library(scales)
library(stargazer) # Used for latex tables to summarize the data and models
```

# Introduction

```{r, echo=FALSE, results='hide'}

# Read the Data
df <- read.csv('Seattle.csv', strip.white = TRUE, stringsAsFactors = FALSE)
# Clean the Data
df$date <- ymd(substr(df$date,1,nchar(df$date) - 7)) # Convert string to date object
df$was_renovated <- as.factor(with(df, 
     ifelse(yr_renovated > 0, 
            1, 
            0
          )
 ))
df$has_basement <- as.factor(with(df, 
     ifelse(sqft_basement > 0, 
            1, 
            0
          )
 ))
```

# Summary Statistics and Graphics

## Quantitative Values

```{r, echo=FALSE, results='hide'}
df.quant <- df %>% select(price,
                          sqft_living,
                          sqft_lot,
                          bedrooms,
                          bathrooms,
                          view,
                          grade,
                          sqft_above,
                          yr_built)
```

```{r, echo=FALSE, results='asis'}

# Print head of initial dataframe
stargazer(head(df.quant), 
          rownames=FALSE, 
          summary=FALSE, 
          header=FALSE, 
          title="First Four Rows for Quantitative Values on Seattlle Housing Dataframe")
```

```{r, echo=FALSE, results='asis'}

# Summarize initial dataframe
stargazer(df.quant,
          header=FALSE,
          omit.summary.stat=c('N'),
          title="Summary Statistics for Values on Seattle Housing Dataframe")
```

```{r, echo=FALSE, out.height="800px"}

# Quantitative Data Pairs
ggpairs(df.quant, progress=FALSE) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

```{r, echo=FALSE, results='asis'}

#Correlation Matrix
stargazer(cor(df.quant),
          header=FALSE,
          title="Correlation of Quantiative Values")
```

## Discrete and Categorical Values

```{r, echo=FALSE}

# Discrete and Categorical Values Section
plot_price_by_cat <- function(df, cat_var, cat_var_name) {
  ggplot(df, aes(x=cat_var, y=price, fill=cat_var)) +
    scale_colour_solarized("red") +
    geom_violin(aes(color=cat_var)) +
    geom_boxplot(width=0.1) +
    xlab(cat_var_name) +
    ylab("Price") +
    scale_y_continuous(labels = scales::dollar_format(scale = 1)) +
    theme(legend.position="none")
}

q <- plot_price_by_cat(df, as.factor(df$view), "View")
r <- plot_price_by_cat(df, as.factor(df$grade), "Grade")
t <- plot_price_by_cat(df, as.factor(df$waterfront), "Waterfront")
w <- plot_price_by_cat(df, as.factor(df$floors), "Floors")
x <- plot_price_by_cat(df, as.factor(df$condition), "Condition")
y <- plot_price_by_cat(df, as.factor(df$has_basement), "Basement")

grid.arrange(grobs=list(q, r, t, 
                        w, x, y),
             ncol=3,
             top="Price by Categorical Variable") 
```


# Analysis

## Initial Model

```{r, echo=FALSE, out.height="200px", out.width="250px", fig.align="center"}

# Initial Model
lm.price <- lm(formula = price ~ sqft_living + grade + view + yr_built + has_basement, 
            data = df)
par(mfrow = c(1,3))
plot(lm.price,c(1,2,4))
```


```{r, echo=FALSE, out.height="150px", fig.align="center"}
boxCox(lm.price, main="Box-Cox Plot of model")
```

```{r, echo=FALSE, out.height="150px", fig.align="center"}
par(mfrow = c(1,3))
lm.price <- lm(formula = log(price) ~ sqft_living + grade + view + yr_built + has_basement, 
            data = df)
plot(lm.price,c(1,2,4))
```


```{r, echo=FALSE, out.height="150px", fig.align="center"}
p <- ggplot(df, aes(x=sqft_living)) + geom_density()
q <- ggplot(df, aes(x=log(sqft_living))) + geom_density()
r <- ggplot(df, aes(x=price)) + geom_density()
s <- ggplot(df, aes(x=log(price))) + geom_density()
grid.arrange(grobs=list(p, q,
                        r, s),
             ncol=2,
             top="Transformations on Skewed Distributions") 
```


```{r, echo=FALSE, results='asis'}
# VIF Table
stargazer(vif(lm.price), title="VIF Values for Price Model", header=FALSE)
```

# Results and Conclusions



\newpage

# Appendix: All Code for This Report

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```